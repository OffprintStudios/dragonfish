<ng-container *ngIf="sectionsQuery.all$ | async | sectionIndex as indexedSections">
    <ng-container *ngIf="sectionsQuery.numSections === 0 && auth.checkPseudonym(this.workPageQuery.authorId); else hasSections">
        <div class="empty">
            <h3>You haven't added anything yet!</h3>
            <p>
                Add some chapters to fill out your work.<br/>Check out the Offprint Omnibus for posting guidelines.
            </p>
        </div>
    </ng-container>
    <ng-template #hasSections>
        <ng-container *ngIf="auth.checkPseudonym(this.workPageQuery.authorId); else notThisUser">
            <ul class="mt-3 mb-6 list-none">
                <ng-container *ngFor="let indexedSection of indexedSections">
                    <li
                        class="section-item border-gray-600 dark:border-white"
                    >
                        <ng-container *ngIf="indexedSection.section.published; else notPublished">
                            <div
                                class="pub-button published border-gray-600 dark:border-white"
                                [matTooltip]="'Convert to Draft'"
                                [matTooltipClass]="'offprint-tooltip'"
                                (click)="pubUnPub(indexedSection.section)"
                            >
                                <rmx-icon name="checkbox-circle-line"></rmx-icon>
                            </div>
                            <div class="section-button mid"
                                [routerLink]="goToSectionReader(indexedSection.index, indexedSection.section.title)"
                            >
                                <div class="flex-1">{{ indexedSection.section.title }}</div>
                                <div class="flex text-xs">
                                    <div class="flex items-center" [matTooltip]="'Words'" [matTooltipClass]="'offprint-tooltip'" [matTooltipShowDelay]="300">
                                        <rmx-icon name="pen-nib-line" class="relative top-1 mr-0.5" style="width: 1rem;"></rmx-icon>
                                        <span>{{ indexedSection.section.stats.words }}</span>
                                    </div>
                                    <div class="text-sm mx-0.5 relative">
                                        •
                                    </div>
                                    <ng-container *ngIf="indexedSection.section.audit.publishedOn; else creationDate">
                                        <div class="flex items-center" [matTooltip]="'Published on'" [matTooltipClass]="'offprint-tooltip'" [matTooltipShowDelay]="300">
                                            <rmx-icon name="calendar-2-line" class="relative top-1 mr-0.5" style="width: 1rem;"></rmx-icon>
                                            <span>{{ indexedSection.section.audit.publishedOn | localedate: 'mediumDate' }}</span>
                                        </div>
                                    </ng-container>
                                    <ng-template #creationDate>
                                        <div class="flex items-center" [matTooltip]="'Created on'" [matTooltipClass]="'offprint-tooltip'" [matTooltipShowDelay]="300">
                                            <rmx-icon name="calendar-2-line" class="relative top-1 mr-0.5" style="width: 1rem;"></rmx-icon>
                                            <span>{{ indexedSection.section.createdAt | localedate: 'mediumDate' }}</span>
                                        </div>
                                    </ng-template>
                                </div>
                            </div>
                        </ng-container>
                        <ng-template #notPublished>
                            <div
                                class="pub-button border-gray-600 dark:border-white"
                                [matTooltip]="'Publish'"
                                [matTooltipClass]="'offprint-tooltip'"
                                *ngIf="indexedSection.section.published === false"
                                (click)="pubUnPub(indexedSection.section)"
                            >
                                <rmx-icon name="checkbox-blank-circle-line"></rmx-icon>
                            </div>
                            <div class="section-button mid"
                                [routerLink]="goToSectionAuthor(indexedSection.section._id)"
                            >
                                <div class="flex-1">{{ indexedSection.section.title }}</div>
                                <div class="flex text-xs">
                                    <div class="flex items-center" [matTooltip]="'Words'" [matTooltipClass]="'offprint-tooltip'" [matTooltipShowDelay]="300">
                                        <rmx-icon name="pen-nib-line" class="relative top-1 mr-0.5" style="width: 1rem;"></rmx-icon>
                                        <span>{{ indexedSection.section.stats.words }}</span>
                                    </div>
                                    <div class="text-sm mx-0.5 relative">
                                        •
                                    </div>
                                    <ng-container *ngIf="indexedSection.section.audit.publishedOn; else creationDate">
                                        <div class="flex items-center" [matTooltip]="'Published on'" [matTooltipClass]="'offprint-tooltip'" [matTooltipShowDelay]="300">
                                            <rmx-icon name="calendar-2-line" class="relative top-1 mr-0.5" style="width: 1rem;"></rmx-icon>
                                            <span>{{ indexedSection.section.audit.publishedOn | localedate: 'mediumDate' }}</span>
                                        </div>
                                    </ng-container>
                                    <ng-template #creationDate>
                                        <div class="flex items-center" [matTooltip]="'Created on'" [matTooltipClass]="'offprint-tooltip'" [matTooltipShowDelay]="300">
                                            <rmx-icon name="calendar-2-line" class="relative top-1 mr-0.5" style="width: 1rem;"></rmx-icon>
                                            <span>{{ indexedSection.section.createdAt | localedate: 'mediumDate' }}</span>
                                        </div>
                                    </ng-template>
                                </div>
                            </div>
                        </ng-template>
                        <div
                            class="pub-button end border-gray-600 dark:border-white"
                            [matTooltip]="'Delete'"
                            [matTooltipClass]="'offprint-tooltip'"
                            (click)="delete(indexedSection.section._id)"
                        >
                            <rmx-icon name="delete-bin-line"></rmx-icon>
                        </div>
                    </li>
                </ng-container>
            </ul>
        </ng-container>
        <ng-template #notThisUser>
            <ul class="mb-6 list-none">
                <ng-container *ngFor="let section of sectionsQuery.pubSections; let i = index">
                    <li
                        class="section-item border-gray-600 dark:border-white"
                    >
                        <div class="section-button" [routerLink]="['section', i + 1, section.title | slugify]">
                            <div class="flex-1">{{ section.title }}</div>
                            <div class="flex text-xs">
                                <div class="flex items-center" [matTooltip]="'Words'" [matTooltipClass]="'offprint-tooltip'" [matTooltipShowDelay]="300">
                                    <rmx-icon name="pen-nib-line" class="relative top-1 mr-0.5" style="width: 1rem;"></rmx-icon>
                                    <span>{{ section.stats.words }}</span>
                                </div>
                                <div class="text-sm mx-0.5 relative">
                                    •
                                </div>
                                <ng-container *ngIf="section.audit.publishedOn; else creationDate">
                                    <div class="flex items-center" [matTooltip]="'Published on'" [matTooltipClass]="'offprint-tooltip'" [matTooltipShowDelay]="300">
                                        <rmx-icon name="calendar-2-line" class="relative top-1 mr-0.5" style="width: 1rem;"></rmx-icon>
                                        <span>{{ section.audit.publishedOn | localedate: 'mediumDate' }}</span>
                                    </div>
                                </ng-container>
                                <ng-template #creationDate>
                                    <div class="flex items-center" [matTooltip]="'Created on'" [matTooltipClass]="'offprint-tooltip'" [matTooltipShowDelay]="300">
                                        <rmx-icon name="calendar-2-line" class="relative top-1 mr-0.5" style="width: 1rem;"></rmx-icon>
                                        <span>{{ section.createdAt | localedate: 'mediumDate' }}</span>
                                    </div>
                                </ng-template>
                            </div>
                        </div>
                    </li>
                </ng-container>
            </ul>
        </ng-template>
    </ng-template>
</ng-container>
