<div class="tools" *ngIf="route.children.length === 0">
    <div class="tool-buttons">
        <!--Go back-->
        <button matRipple class="tool" [matTooltip]="'Go Back'" [matTooltipClass]="'offprint-tooltip'" (click)="goBack()"><i-feather name="chevron-left"></i-feather>Back</button>
        <span class="tool-divider"></span>

        <!--Creation Tools-->
        <ng-container [ngSwitch]="myProse.audit.published">
            <button *ngSwitchCase="pubStatus.Published" matRipple class="tool active">
                <i-feather name="check-circle"></i-feather>Published
            </button>
            <button *ngSwitchCase="pubStatus.Unpublished" matRipple class="tool">
                <i-feather name="circle"></i-feather>Unpublished
            </button>
            <button *ngSwitchCase="pubStatus.Pending" matRipple class="tool">
                <i-feather name="clock"></i-feather>Pending
            </button>
            <button *ngSwitchCase="pubStatus.Rejected" matRipple class="tool">
                <i-feather name="x-circle"></i-feather>Rejected
            </button>
            <button *ngSwitchCase="pubStatus.ApprovedUnpublished" matRipple class="tool">
                <i-feather name="circle"></i-feather>Approved
            </button>
        </ng-container>
        <span class="tool-divider"></span>

        <!--Filtering tools-->
        <button matRipple class="tool left disabled" matTooltip="List View" matTooltipClass="offprint-tooltip">
            <i-feather class="no-text" name="list"></i-feather>
        </button>
        <button matRipple class="tool mid disabled" matTooltip="Icon View" matTooltipClass="offprint-tooltip">
            <i-feather class="no-text" name="grid"></i-feather>
        </button>
        <button matRipple class="tool end disabled" matTooltip="Filter" matTooltipClass="offprint-tooltip">
            <i-feather class="no-text" name="filter"></i-feather>
        </button>
        <span class="tool-divider"></span>

        <!--Content tools-->
        <button matRipple class="tool left disabled" matTooltip="Deselect" matTooltipClass="offprint-tooltip">
            <i-feather class="no-text" name="x"></i-feather>
        </button>
        <button matRipple class="tool mid" matTooltip="Edit" matTooltipClass="offprint-tooltip" (click)="editWork()">
            <i-feather class="no-text" name="edit-3"></i-feather>
        </button>
        <button matRipple class="tool end" matTooltip="Delete" matTooltipClass="offprint-tooltip" (click)="deleteWork()">
            <i-feather class="no-text" name="trash-2"></i-feather>
        </button>
    </div>
    <form class="tool-search">
        <div class="search-bar">
            <input type="text" class="search-input disabled" placeholder="Search your stuff..." disabled>
            <button matRipple class="search-submit disabled" type="submit"><i-feather name="search"></i-feather></button>
        </div>
    </form>
</div>

<div class="view-container">
    <div class="view-info">
        <div class="view-coverart">
            <div class="add-coverart" [matTooltip]="'Add Cover Art'" [matTooltipClass]="'offprint-tooltip'">
                <i-feather name="plus"></i-feather>
            </div>
        </div>
        <div class="view-header">
            <div class="view-title">
                <rating-icon [rating]="myProse.meta.rating"></rating-icon>
                <h2>{{ myProse.title }}</h2>
            </div>
            <div class="view-tags">
                <span class="tag" [matTooltip]="'Prose'" [matTooltipClass]="'offprint-tooltip'"><i-feather name="book-open" class="kind"></i-feather></span>
                <span class="divider">//</span>
                <span class="tag">{{ myProse.meta.category }}</span>
                <span class="divider">//</span>
                <span class="tag">{{ myProse.meta.genres | separateEntities }}</span>
            </div>
            <div class="view-description">
                <div class="html-description" [innerHtml]="myProse.body | safeHtml"></div>
            </div>
            <div class="view-stats">
                <span class="tag" [matTooltip]="'Created On'" [matTooltipClass]="'offprint-tooltip'"><i-feather name="calendar"></i-feather>{{ myProse.createdAt | date:'mediumDate' }}</span>
                <span class="divider">//</span>
                <span class="tag" [matTooltip]="'Comments'" [matTooltipClass]="'offprint-tooltip'"><i-feather name="message-circle"></i-feather>{{ myProse.stats.comments | abbreviate }}</span>
                <span class="divider">//</span>
                <span class="tag" [matTooltip]="'Views'" [matTooltipClass]="'offprint-tooltip'"><i-feather name="eye"></i-feather>{{ myProse.stats.views | abbreviate }}</span>
                <span class="divider">//</span>
                <span class="tag" [matTooltip]="'Likes'" [matTooltipClass]="'offprint-tooltip'"><i-feather name="thumbs-up"></i-feather>{{ myProse.stats.likes | abbreviate }}</span>
                <span class="divider">//</span>
                <span class="tag" [matTooltip]="'Dislikes'" [matTooltipClass]="'offprint-tooltip'"><i-feather name="thumbs-down"></i-feather>{{ myProse.stats.dislikes | abbreviate }}</span>
                <span class="divider">//</span>
                <span class="tag" [matTooltip]="'Words'" [matTooltipClass]="'offprint-tooltip'"><i-feather name="pen-tool"></i-feather>{{ myProse.stats.words | abbreviate }}</span>
            </div>
        </div>
    </div>
    <div class="view-sections">
        <!--Loading sections-->
        <ng-container *ngIf="loadingSections; else viewSections">
            <div class="empty">
                <mat-spinner></mat-spinner>
            </div>
        </ng-container>

        <!--After loading, display something-->
        <ng-template #viewSections>
            <div class="sections-list">
                <ng-container *ngIf="!editMode; else disabledAddButton">
                    <div class="add-section" (click)="addSection()">
                        <i-feather name="plus"></i-feather><span class="button-text">SECTION</span>
                    </div>
                </ng-container>
                <ng-template #disabledAddButton>
                    <div class="add-section" (click)="exitEditMode()">
                        <i-feather name="chevron-left"></i-feather><span class="button-text">BACK</span>
                    </div>
                </ng-template>
                <ng-container *ngIf="!editMode; else disabledSections">
                    <ng-container *ngFor="let section of mySections">
                        <div class="section-box" [ngClass]="{'active': section.selected}" (click)="selectThisSection(section)">
                            <div class="section-indicator">
                                <ng-container *ngIf="section.published; else sectionUnpublished">
                                    <i-feather name="check-circle"></i-feather>
                                </ng-container>
                                <ng-template #sectionUnpublished>
                                    <i-feather name="circle"></i-feather>
                                </ng-template>
                            </div>
                            <div class="section-title">
                                {{ section.title }}
                            </div>
                        </div>
                    </ng-container>
                </ng-container>
                <ng-template #disabledSections>
                    <ng-container *ngFor="let section of mySections">
                        <div class="section-box disabled">
                            <div class="section-title">
                                {{ section.title }}
                            </div>
                        </div>
                    </ng-container>
                </ng-template>
            </div>
            <div class="section-container">
                <ng-container *ngIf="editMode; else viewMode">
                    <div class="form-container">
                        <div class="form-header">
                            <h3>Add a Section</h3>
                            <button (click)="submitForm()">Save</button>
                        </div>
                        <form [formGroup]="sectionForm">
                            <mat-form-field style="width: 100%;" appearance="outline">
                                <mat-label>Title</mat-label>
                                <input matInput placeholder="The Beginning Of A Great Adventure" [formControlName]="'title'">
                            </mat-form-field>

                            <editor [parentForm]="sectionForm" [controlName]="'body'" [minHeight]="'750px'" [maxHeight]="'750px'"></editor>
                        </form>
                    </div>
                </ng-container>

                <ng-template #viewMode>
                    <ng-container *ngIf="mySections.length === 0; else selectSection">
                        <div class="empty">
                            <h3>It's lonely in here...</h3>
                            <p>Looks like you haven't added any sections yet.</p>
                            <p>Why not hit the Add Section button on the side?</p>
                        </div>
                    </ng-container>
                    <ng-template #selectSection>
                        <ng-container *ngIf="selectedSection; else nothingSelected">
                            <section-item [section]="selectedSection" [contentId]="myProse._id"></section-item>
                        </ng-container>
                        <ng-template #nothingSelected>
                            <div class="empty">
                                <h3>You haven't selected a section yet</h3>
                                <p>Click on any of the tabs to the left to get started!</p>
                            </div>
                        </ng-template>
                    </ng-template>
                </ng-template>
            </div>
        </ng-template>
    </div>
</div>